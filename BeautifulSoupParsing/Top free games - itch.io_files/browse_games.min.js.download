(function(){var MEMORY_KEYS_KEY,MEMORY_MAX_ITEMS,slice=[].slice,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;MEMORY_MAX_ITEMS=10;MEMORY_KEYS_KEY="inputmemory_keys";window.I={libs:{react:$.Deferred(function(_this){return function(d){if(typeof React!=="undefined"&&React!==null){return d.resolve(React)}}}(this)),selectize:$.Deferred(function(_this){return function(d){var ref;if(typeof $!=="undefined"&&$!==null?(ref=$.fn)!=null?ref.selectize:void 0:void 0){return d.resolve($.fn.selectize)}}}(this)),redactor:$.Deferred(function(_this){return function(d){var ref;if(typeof $!=="undefined"&&$!==null?(ref=$.fn)!=null?ref.redactor:void 0:void 0){return d.resolve($.fn.redactor)}}}(this))},setup_page:function(){I.setup_register_referrers($(document.body));return _.defer(function(_this){return function(){return I.setup_affiliate_code()}}(this))},root_url:function(){var host;host=null;return function(path){if(!host){host=$("body").data("host")||"";if(host!==""){host=window.location.protocol+"//"+host;if(window.location.port&&window.location.port!=="80"){host+=":"+window.location.port}}}return host+"/"+path}}(),page_name:function(){return $(document.body).data("page_name")||"unknown"},get_csrf:function(){return this._csrf_token||(this._csrf_token=$("meta[name='csrf_token']").attr("value"))},with_csrf:function(thing){var token;if(thing==null){thing={}}token={csrf_token:I.get_csrf()};if($.type(thing)==="string"){return thing+"&"+$.param(token)}else{return $.extend(thing,token)}},add_params:function(_this){return function(url,p){var rest;rest=$.param(p);if(url.match(/\?/)){return url+"&"+rest}else{return url+"?"+rest}}}(this),flash:function(flash,type){if(type==null){type="notice"}this.flasher||(this.flasher=new I.Flasher);if(flash.match(/^error:/)){flash=flash.replace(/^error:/,"Error: ");type="error"}return this.flasher.show(type,flash)},slugify:function(str,opts){str=str.replace(/\s+/g,"-");str=(opts!=null?opts.for_tags:void 0)?str.replace(/[^\w_.-]/g,"").replace(/^[_.-]+/,"").replace(/[_.-]+$/,""):str.replace(/[^\w_-]/g,"");return str.toLowerCase()},truncate:function(s,len){if(s.length>len+3){return _.string.truncate(s,len)}else{return s}},ecommerce_event:function(event){if(window.ga){ga("ecommerce:addTransaction",event.transaction);ga("ecommerce:addItem",event.item);return ga("ecommerce:send")}else{return console.log("ecommerce event:",event)}},event:function(category,action,label,value,interactive){var opts;if(interactive==null){interactive=true}opts={hitType:"event",eventCategory:category,eventAction:action,eventLabel:label,eventValue:value};if(!interactive){opts.nonInteraction=1}return I.event_with_opts(opts)},event_with_opts:function(opts){try{if(typeof ga!=="undefined"&&ga!==null){return ga("send",opts)}else{console.log("event:",opts);return typeof opts.hitCallback==="function"?opts.hitCallback():void 0}}catch(error){}},event2:function(){var args;args=1<=arguments.length?slice.call(arguments,0):[]},parse_money:function(str){var cents;cents=str&&parseInt(str.replace(/[^\d]/g,""),10);return cents||0},currency_symbols:{USD:"$",GBP:"£",EUR:"€",JPY:"¥"},currency_formats:{USD:{prefix:"$"},GBP:{prefix:"£"},JPY:{prefix:"¥"},EUR:{suffix:"€"}},format_money:function(cents,currency){var dollars,symbol;if(currency==null){currency="USD"}if(cents<0){return"-"+I.format_money(-cents,currency)}symbol=I.currency_symbols[currency]||"$";if(currency==="JPY"){return symbol+cents}else{dollars=_.str.numberFormat(cents/100,2);if(currency==="EUR"){return""+dollars+symbol}else{return""+symbol+dollars}}},money_input:function(input,opts){var currency,format;if(opts==null){opts={}}input=$(input);currency=opts.currency||input.data("currency");format=I.currency_formats[currency]||{prefix:"$"};return input.maskMoney($.extend({affixesStay:true,precision:currency==="JPY"?0:2},format,opts))},plural:function(noun,count){if(count===1){return count+" "+noun}else{return count+" "+noun+"s"}},default_redactor_opts:{plugins:["source","table","alignment","video","addimage"],toolbarFixed:false,buttons:["format","bold","italic","deleted","lists","link"],minHeight:250,linkSize:80},add_recaptcha_if_necessary:function(form,errors){if(errors[0]!=="recaptcha"){return}if(!form.data("adding_recaptcha")){form.data("adding_recaptcha",true);I.with_recaptcha(function(_this){return function(){var el;el=form.find(".g-recaptcha");I.event("recaptcha","show",I.page_name());return grecaptcha.render(el[0],{sitekey:el.data("sitekey")})}}(this))}form.set_form_errors(["Please fill out the CAPTCHA to continue"]);return true},with_recaptcha:function(_this){return function(fn){var url;if(window.grecaptcha){return fn(_this)}else if(_this.recaptcha_deferred){return _this.recaptcha_deferred.done(fn)}else{_this.recaptcha_deferred=$.Deferred().done(fn);window._itch_recaptcha_loaded=function(){return this.recaptcha_deferred.resolve()};url="https://www.google.com/recaptcha/api.js?onload=_itch_recaptcha_loaded&render=explicit";return $('<script type="text/javascript">').attr("src",url).appendTo("head")}}}(this),wait_for_object:function(_this){return function(obj,name,fn){var add,t,tick;t=1;add=10;tick=function(){if(obj[name]){return typeof fn==="function"?fn():void 0}t+=add;t=Math.min(500,t);return setTimeout(tick,t)};return tick()}}(this),with_redactor:function(_this){return function(fn){return I.wait_for_object($.fn,"redactor",fn)}}(this),with_selectize:function(_this){return function(fn){return I.libs.selectize.done(fn)}}(this),redactor:function(_this){return function(el,opts){var e,p;if(opts==null){opts={}}if(window.location.href.match(/\bredactor=0\b/)){return}if(!$.fn.redactor){console.warn("tried to create redactor text element without redactor on page",el[0]);return}opts=$.extend({},I.default_redactor_opts,opts);if(opts.source===false){delete opts.source;opts.plugins=function(){var j,len1,ref,results;ref=opts.plugins;results=[];for(j=0,len1=ref.length;j<len1;j++){p=ref[j];if(p!=="source"){results.push(p)}}return results}()}try{return el.redactor(opts)}catch(error){e=error;I.event("error","redactor","invalid_content");return el.parent().replaceWith(el).end().val("").redactor(opts)}}}(this),get_template:function(name){return _.template($("#"+name+"_tpl").html())},lazy_template:function(obj,name){return function(){var args,fn;args=1<=arguments.length?slice.call(arguments,0):[];fn=I.get_template(name);obj.prototype.template=fn;return fn.apply(null,args)}},setup_sticky_bar:function(trigger){var body,visible,win;win=$(window);body=$(document.body);trigger=$(trigger);visible=false;return win.on("scroll",function(_this){return function(e){if(win.scrollTop()>trigger.offset().top+trigger.outerHeight()){if(!visible){body.addClass("show_sticky_bar");return visible=true}}else{if(visible){body.removeClass("show_sticky_bar");return visible=false}}}}(this))},setup_selectize:function(el){return el.find(".selectize_input").each(function(i,input){var $input,REGEX_EMAIL,descriptions,optgroups,options,params,placeholder,render;$input=$(input);if($input.hasClass("selectized")){return}params={plugins:[],persist:false};if($input.is("select")){descriptions={};$input.find("option").each(function(i,option){var $option;$option=$(option);return descriptions[$option.val()]=$option.data("extra")});render=function(data,escape){var content,desc;content=escape(data.text);if(desc=descriptions[data.value]){content=content+" <span class='sub'>— "+desc+"</span>"}return"<div>"+content+"</div>"};params.render={item:render,option:render}}if(placeholder=$input.data("placeholder")){params.placeholder=placeholder}if($input.hasClass("dropdown")){params.maxItems=1}if($input.hasClass("email_selector")){REGEX_EMAIL="([a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+"(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)";params.valueField="email";params.labelField="name";params.searchField=["name","email"];params.render={item:function(item,escape){return"<div>"+(item.name?'<span class="name">'+escape(item.name)+"</span>":"")+(item.email?'<span class="email">'+escape(item.email)+"</span>":"")+"</div>"},option:function(item,escape){var caption,label;label=item.name||item.email;caption=item.name?item.email:null;return"<div>"+'<span class="label">'+escape(label)+"</span>"+(caption?'<span class="caption">'+escape(caption)+"</span>":"")+"</div>"}};params.createFilter=function(input){var match,regex;regex=new RegExp("^"+REGEX_EMAIL+"$","i");match=input.match(regex);if(match){return!this.options.hasOwnProperty(match[0])}regex=new RegExp("^([^<]*)<"+REGEX_EMAIL+">$","i");match=input.match(regex);if(match){return!this.options.hasOwnProperty(match[2])}return false};params.create=function(input){var match;if(new RegExp("^"+REGEX_EMAIL+"$","i").test(input)){return{email:input}}match=input.match(new RegExp("^([^<]*)<"+REGEX_EMAIL+">$","i"));if(match){return{email:match[2],name:$.trim(match[1])}}alert("Invalid email address.");return false}}if(options=$input.data("options")){if($input.hasClass("email_selector")){params.options=options}else if($input.hasClass("options_object")){params.options=options;params.searchField=["text","keywords"]}else{params.options=options.map(function(opt){return{value:opt[0],text:opt[1]}})}params.plugins.push("remove_button");params.delimiter=",";params.persist=false}if(optgroups=$input.data("optgroups")){params.optgroups=optgroups}return $input.selectize(params)})},format_dates:function(outer,method){var el,j,len1,ref,results;if(method==null){method="calendar"}moment.lang("en",{calendar:{lastDay:"[Yesterday at] LT",sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",lastWeek:"[last] dddd [at] LT",nextWeek:"dddd [at] LT",sameElse:"MMMM Do YYYY [at] LT"}});ref=outer.find(".date_format");results=[];for(j=0,len1=ref.length;j<len1;j++){el=ref[j];results.push(function(el){var full_date,method_args,real_method,ref1;real_method=el.data("format_method")||method;method_args=el.data("format_args")||[];if(!_.isArray(method_args)){method_args=[method_args]}full_date=el.html();return el.html((ref1=moment.utc(full_date).local())[real_method].apply(ref1,method_args)).attr("title",full_date+" UTC")}($(el)))}return results},specific_humanize:function(duration,num_parts){var fn,j,key,len1,out,pair,pairs,single,val;if(num_parts==null){num_parts=null}pairs=[["y","years","a year"],["m","months","a month"],["d","days","a day"],["h","hours","an hour"],["m","minutes","a minute"],["s","seconds","a second"]];out=[];for(j=0,len1=pairs.length;j<len1;j++){pair=pairs[j];if(num_parts&&out.length===num_parts){break}key=pair[0],fn=pair[1],single=pair[2];val=duration[fn]();if(val>0){if(val>1){if(fn==="seconds"){out.push("a few seconds")}else{out.push(val+" "+fn)}}else{out.push(single)}}}if(out.length>1){out[out.length-1]="and "+out[out.length-1]}return out.join(", ")},format_filesize:function(outer,selector){var file_size,j,len1,ref,results;if(selector==null){selector=".file_size_value"}ref=outer.find(selector);results=[];for(j=0,len1=ref.length;j<len1;j++){file_size=ref[j];file_size=$(file_size);results.push(file_size.html(_.str.formatBytes(parseInt(file_size.html()))))}return results},adjust_font_size_to_fit:function(_this){return function(el,min_size){var _el,font_size,results;if(min_size==null){min_size=16}if(!el.length){return}font_size=el.css("font-size");font_size=parseInt(font_size.match(/\d+/),10);_el=el[0];results=[];while(_el.offsetWidth<_el.scrollWidth){font_size-=2;if(font_size<min_size){break}results.push(el.css("font-size",font_size+"px"))}return results}}(this),date_format:"yy-mm-dd",time_format:"HH:mm:ss",to_local_time:function(t){return moment.utc(t,"YYYY-MM-DD HH:mm:ss").local().toDate()},format_date_time:function(d){var date,time;time=$.datepicker.formatTime(this.time_format,{hour:d.getHours(),minute:d.getMinutes(),second:d.getSeconds()});date=$.datepicker.formatDate(this.date_format,new Date(d));return date+" "+time},format_date:function(d){return $.datepicker.formatDate(this.date_format,new Date(d))},datetimepicker:function(pickers,opts){var j,len1,p,picker,val;for(j=0,len1=pickers.length;j<len1;j++){p=pickers[j];picker=$(p);if(val=picker.attr("value")){picker.val(this.format_date_time(this.to_local_time(val)))}}return pickers.datetimepicker($.extend({timeFormat:this.time_format,dateFormat:this.date_format,beforeShow:function(_this){return function(){_.defer(function(){return $("#ui-datepicker-div").css("z-index",100)});return void 0}}(this)},opts))},datepicker:function(pickers,opts){return pickers.datepicker($.extend({dateFormat:this.date_format,beforeShow:function(_this){return function(){_.defer(function(){return $("#ui-datepicker-div").css("z-index",100)});return void 0}}(this)},opts))},slug_input:function(_this){return function(input,bound_input){var valid_slug_chars;valid_slug_chars=/[a-z_0-9_-]/g;input.on("keypress",function(e){var char;if(e.keyCode>=32){char=String.fromCharCode(e.keyCode);if(!char.match(valid_slug_chars)){return false}}});if(bound_input&&bound_input.length){input.on("change",function(e){var slug;slug=I.slugify(bound_input.val());if(input.val().match(/^\s*$/)&&slug!==""){return input.val(slug)}});return bound_input.on("change",function(e){if(input.val().match(/^\s*$/)){return input.val(I.slugify($(e.currentTarget).val()))}})}}}(this),deferred_links:function(el,selector,promise_fn){promise_fn||(promise_fn=I.delegate_tracking);el.on("mouseup",selector,function(e){var target;if(e.which!==2){return}target=$(e.currentTarget);return promise_fn(target,e)});return el.on("click",selector,function(e){var finished,is_blank,ref,target;if(e.which!==1){return}target=$(e.currentTarget);is_blank=e.metaKey||e.ctrlKey||e.shiftKey||target.attr("target")==="_blank";finished=null;if(!is_blank){finished=function(_this){return function(){if(!finished){return}finished=null;return window.location=target.attr("href")}}(this);setTimeout(function(_this){return function(){return typeof finished==="function"?finished():void 0}}(this),200)}if((ref=promise_fn(target,e))!=null){ref.done(finished)}if(!is_blank){return false}})},delegate_tracking:function(_this){return function(el){var promises;promises=[];el.trigger("i:delegate_tracking",[function(p){return promises.push(p)}]);return $.when.apply($,promises)}}(this),ga_tracker:function(_this){return function(category,action,label,value){var send_event;return send_event=function(target){var opts,ref,ref1,ref2,ref3;opts={hitType:"event",eventCategory:(ref=target.data("category"))!=null?ref:category,eventAction:(ref1=target.data("action"))!=null?ref1:action,eventLabel:(ref2=target.data("label"))!=null?ref2:label,eventValue:(ref3=target.data("value"))!=null?ref3:value};return $.Deferred(function(_this){return function(d){opts.hitCallback=function(){return d.resolve()};return I.event_with_opts(opts)}}(this))}}}(this),tracked_links:function(){var action,category,el,label,rest,tracker,value;el=arguments[0],rest=2<=arguments.length?slice.call(arguments,1):[];category=rest[0],action=rest[1],label=rest[2],value=rest[3];tracker=I.ga_tracker(category,action,label,value);I.deferred_links(el,"a[data-label]",tracker);return el.on("i:track_link",function(e,l){var _label;if(l){_label=l[0]}return I.ga_tracker(category,action,_label!=null?_label:label,value)($(e.target))})},set_cookie:function(name,value,opts){if(opts==null){opts={}}if(I.in_dev){console.log("set cookie:",[name,value],opts)}return Cookies.set(name,value,$.extend({path:"/",domain:"."+$(document.body).data("host")},opts))},set_register_referrer:function(_this){return function(action){var page;page=I.page_name();if(page!=null){I.set_cookie("ref:register:page_params",page)}if(action!=null){return I.set_cookie("ref:register:action",action)}}}(this),setup_register_referrers:function(_this){return function(el){if(I.current_user){return}return el.on("mouseup","[data-register_action]",function(e){var action;action=$(e.currentTarget).data("register_action");return I.set_register_referrer(action)})}}(this),setup_affiliate_code:function(_this){return function(code,replace){var location,ref;if(replace==null){replace=false}if(code==null){code=(ref=window.location.search.match(/\bac=([\w\d]+)/))!=null?ref[1]:void 0}if(!code){return}if(!replace&&code===Cookies.get("acode")){return}I.set_cookie("acode",code,{expires:1});if(document.referrer){I.set_cookie("acode:ref",document.referrer.substring(0,180),{expires:1})}location=window.location.href.replace(/\?.*$/,"").substring(0,180);return I.set_cookie("acode:land",location,{expires:1})}}(this),setup_grid_referrers:function(_this){return function(el,value_fn){var set_cookie_for;set_cookie_for=function(el){var game_id,sale,sale_id,sale_type;if(!el.closest(".game_author").length){if(game_id=el.closest("[data-game_id]").data("game_id")){I.ReferrerTracker.push("game",game_id,value_fn(el))}}if(!el.closest(".sale_author").length){sale=el.closest("[data-sale_id]");if(sale_id=sale.data("sale_id")){sale_type=sale.data("sale_type");return I.ReferrerTracker.push(sale_type,sale_id,value_fn(el))}}};el.on("mouseup",".game_cell a, .sale_row a, .leader_game a",function(e){if(e.which>3){return}return set_cookie_for($(e.currentTarget))});return el.on("i:track_link",function(e){return set_cookie_for($(e.target))})}}(this),bind_checkbox_to_input:function(_this){return function(checkbox,input,callback){var update_state;update_state=function(){var checked;checked=checkbox.prop("checked");input.prop("disabled",checked);return typeof callback==="function"?callback(checked):void 0};checkbox.on("change",update_state);return update_state()}}(this),add_facebook:function(_this){return function(callback){var fjs,id,js;if(window.FB){return}_this.add_facebook=function(){};$('<div id="fb-root"></div>').appendTo(document.body);id="facebook-jssdk";if(document.getElementById(id)){return}if(callback!=null){window.fbAsyncInit=callback}fjs=document.getElementsByTagName("script")[0];js=document.createElement("script");js.id=id;js.src="//connect.facebook.net/en_GB/sdk.js#xfbml=1&appId=537395183072744&version=v2.0";return fjs.parentNode.insertBefore(js,fjs)}}(this),add_twitter:function(_this){return function(){var fjs,id,js;id="twitter-wjs";if(document.getElementById(id)){return}_this.add_twitter=function(){};fjs=document.getElementsByTagName("script")[0];js=document.createElement("script");js.id="twitter-wjs";js.src="//platform.twitter.com/widgets.js";return fjs.parentNode.insertBefore(js,fjs)}}(this),add_react:function(){var loading_react,placeholder;loading_react=$.Deferred();I.add_react=function(){return loading_react};I.libs.react.done(function(_this){return function(){return loading_react.resolve()}}(this));placeholder=$("#lib_react_src");placeholder.replaceWith($('<script type="text/javascript">').attr("src",placeholder.data("src")));return loading_react},has_follow_button:function(_this){return function(el,opts){var animate_follow,animate_unfollow,cls,params,ref,ref1,ref2;if(opts==null){opts={}}el=$(el);cls=(ref=opts.cls)!=null?ref:"follow_button_widget";animate_follow=(ref1=opts.animate_follow)!=null?ref1:"animate_bounce";animate_unfollow=(ref2=opts.animate_unfollow)!=null?ref2:"animate_drop_down";params={};params[cls]=function(btn){var data,following,timeout,url;if(!I.current_user){return"continue"}if(btn.is(".loading")){return}btn.removeClass(animate_follow+" "+animate_unfollow);timeout=$.Deferred(function(d){return setTimeout(function(){return d.resolve()},500)});following=btn.is(".is_following");url=following?(_.defer(function(){return btn.addClass(animate_unfollow)}),btn.data("unfollow_url")):(_.defer(function(){return btn.addClass(animate_follow)}),btn.data("follow_url"));btn.addClass("loading").trigger("i:track_link",["follow_btn"]);data=btn.data("follow_data")||{};return $.when($.post(url,I.with_csrf(data)),timeout).done(function(arg){var res;res=arg[0];btn.removeClass("loading "+animate_follow+" "+animate_unfollow);if(res.errors){I.flash(res.errors.join(", "));return}return btn.toggleClass("is_following",res.following).trigger("i:follow_updated",[{user_id:btn.data("user_id"),following:res.following,btn:btn}])})};el.dispatch("click",params);return $(document.body).on("i:follow_updated",function(e,arg){var btn,following,user_id;user_id=arg.user_id,following=arg.following,btn=arg.btn;return el.find("."+cls+"[data-user_id="+user_id+"]").not(btn).toggleClass("is_following",following)})}}(this),is_mobile:function(_this){return function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}}(this),is_ios:function(_this){return function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}}(this),strip_css:function(_this){return function(str){return str.replace(/<\s*\/\s*style\s*>/i,"")}}(this),request_fullscreen:function(_this){return function(el,orientation){var entered,ref,ref1;entered=el.requestFullscreen?(el.requestFullscreen(),true):el.msRequestFullscreen?(el.msRequestFullscreen(),true):el.mozRequestFullScreen?(el.mozRequestFullScreen(),true):el.webkitRequestFullscreen?(el.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),true):false;if(entered&&orientation){if((ref=window.screen)!=null){if((ref1=ref.orientation)!=null){if(typeof ref1.lock==="function"){ref1.lock(orientation)}}}}return entered}}(this),is_fullscreen:function(_this){return function(){return!(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement)}}(this),exit_fullscreen:function(_this){return function(){if(document.exitFullscreen){return document.exitFullscreen()}else if(document.msExitFullscreen){return document.msExitFullscreen()}else if(document.mozCancelFullScreen){return document.mozCancelFullScreen()}else if(document.webkitExitFullscreen){return document.webkitExitFullscreen()}}}(this),toggle_fullscreen:function(_this){return function(el,orientation){if(I.is_fullscreen()){I.exit_fullscreen();return false}else{if(!I.request_fullscreen(el,orientation)){return"failed"}return true}}}(this),setup_dirty_warning:function(_this){return function(form,cb){cb||(cb=function(){return form.data("dirty")});form.data("dirty",false);$(window).on("beforeunload",function(){var msg;msg=cb();if(!msg){return}switch(typeof msg){case"string":return msg;default:return"You've made modifications to this page."}});form.on("i:after_submit",function(){return form.data("dirty",false)});return _.defer(function(){form.on("change","input, select, textarea",function(e){return form.data("dirty",true)});return form.on("keydown, mousedown",".redactor-editor",function(){return form.data("dirty",true)})})}}(this),remote_submit:function(_this){return function(form,more_data){var buttons,data;form.trigger("i:before_submit");data=form.serializeArray();buttons=form.addClass("loading").find("button, input[type='submit'], input[type='checkbox']").prop("disabled",true).addClass("disabled");return $.when(more_data).then(function(d){var ref;if(d){data=data.concat(d)}return $.ajax({data:data,type:(ref=form.attr("method"))!=null?ref:"POST",dataType:"json",url:form.attr("action"),xhrFields:{withCredentials:true},error:function(xhr){var res;res=function(){try{return JSON.parse(xhr.responseText)}catch(error){}}();if(res!=null?res.errors:void 0){return I.flash(res.errors.join(", "))}else{return I.flash("We seem to be having server problems right now! Please try again later.")}},complete:function(){buttons.prop("disabled",false).removeClass("disabled");form.removeClass("loading");return form.trigger("i:after_submit")}}).then(null,function(xhr){try{return JSON.parse(xhr.responseText)}catch(error){}})})}}(this),is_middle_click:function(_this){return function(e){return 2===e.which||e.metaKey||e.ctrlKey}}(this),escape_regex:function(_this){return function(str){return str.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}(this),move:function(array,item,dir){var copy,idx,o,target_idx;idx=array.indexOf(item);if(idx===-1){throw"Failed to find object in array"}target_idx=idx+dir;if(target_idx<0||target_idx>=array.length){throw"Movement is outside of array ("+target_idx+") [0, "+(array.length-1)+"]"}copy=function(){var j,len1,results;results=[];for(j=0,len1=array.length;j<len1;j++){o=array[j];if(o!==item){results.push(o)}}return results}();copy.splice(target_idx,0,item);return copy},format_integer:function(num){if(num>1e7){return Math.floor(num/1e6)+"m"}else if(num>=1e6){return Math.floor(num/1e5)/10+"m"}else if(num>1e4){return Math.floor(num/1e3)+"k"}else if(num>=1e3){return Math.floor(num/100)/10+"k"}else{return""+num}},store_memory:function(key,value){var k,remaining_keys,stored_keys,to_remove;if(!window.localStorage){return}stored_keys=function(){try{return JSON.parse(localStorage.getItem(MEMORY_KEYS_KEY))}catch(error){}}();stored_keys||(stored_keys=[]);if(stored_keys[0]!==key){remaining_keys=function(){var j,len1,results;results=[];for(j=0,len1=stored_keys.length;j<len1;j++){k=stored_keys[j];if(key!==k){results.push(k)}}return results}();stored_keys=[key].concat(remaining_keys);while(stored_keys.length>MEMORY_MAX_ITEMS){to_remove=stored_keys.pop();if(typeof localStorage!=="undefined"&&localStorage!==null){localStorage.removeItem(to_remove)}}localStorage.setItem(MEMORY_KEYS_KEY,JSON.stringify(stored_keys))}return localStorage.setItem(key,value)},clear_memory:function(key){var k,stored_keys;if(!window.localStorage){return}stored_keys=function(){try{return JSON.parse(localStorage.getItem(MEMORY_KEYS_KEY))}catch(error){}}();if(stored_keys){localStorage.setItem(MEMORY_KEYS_KEY,JSON.stringify(function(){var j,len1,results;results=[];for(j=0,len1=stored_keys.length;j<len1;j++){k=stored_keys[j];if(key!==k){results.push(k)}}return results}()))}try{return localStorage.removeItem(key)}catch(error){}}};$(function(){var match;if(match=window.location.hash.match(/\bflash=([^&]*)/)){I.flash(match[1]);window.location.hash=window.location.hash.replace(/\bflash=([^&]*)/,"")}if(I.ie){return $(document.body).addClass("ie")}});I.Flasher=function(){Flasher.prototype.duration=1e4;Flasher.prototype.animation_duration=250;Flasher.prototype.clipping="-7px";function Flasher(){$(document).on("click",".global_flash",function(_this){return function(){return _this.dismiss()}}(this))}Flasher.prototype.dismiss=function(){var elm;if(elm=this.current_flash){if(this.timeout){clearTimeout(this.timeout);this.timeout=null}elm.css({"margin-top":"-"+(elm.outerHeight()+4)+"px"});return setTimeout(function(_this){return function(){return elm.remove()}}(this),this.animation_duration*2)}};Flasher.prototype.show=function(type,msg){var elm;this.dismiss();elm=$("<div class='global_flash "+type+"'>").text(msg).appendTo("body");elm.css({"margin-left":"-"+elm.width()/2+"px","margin-top":"-"+(elm.outerHeight()+4)+"px"});this.timeout=setTimeout(function(_this){return function(){elm.addClass("animated");elm.css({"margin-top":_this.clipping});return setTimeout(function(){return _this.dismiss()},_this.duration)}}(this),100);return this.current_flash=elm};return Flasher}();I.InfiniteScroll=function(){InfiniteScroll.prototype.loading_element=".grid_loader";function InfiniteScroll(el){this.el=$(el);this.setup_loading()}InfiniteScroll.prototype.get_next_page=function(){return alert("override me")};InfiniteScroll.prototype.setup_loading=function(){var check_scroll_pos,win;this.loading_row=this.el.find(this.loading_element);if(!this.loading_row.length){return}win=$(window);check_scroll_pos=function(_this){return function(){if(_this.el.is(".loading")){return}if(win.scrollTop()+win.height()>=_this.loading_row.offset().top){return _this.get_next_page()}}}(this);win.on("scroll.browse_loader",check_scroll_pos);return check_scroll_pos()};InfiniteScroll.prototype.remove_loader=function(){$(window).off("scroll.browse_loader");return this.loading_row.remove()};return InfiniteScroll}();I.InfiniteGameGrid=function(superClass){extend(InfiniteGameGrid,superClass);function InfiniteGameGrid(){return InfiniteGameGrid.__super__.constructor.apply(this,arguments)}InfiniteGameGrid.prototype.method="post";InfiniteGameGrid.prototype.current_page=1;InfiniteGameGrid.prototype.get_next_page=function(){this.current_page+=1;this.el.addClass("loading");return $[this.method]("",{page:this.current_page,format:"json"},function(_this){return function(res){_this.el.removeClass("loading");if(res.num_items>0){return _this.grid.add_image_loading($(res.content).appendTo(_this.grid.el).hide().fadeIn())}else{return _this.remove_loader()}}}(this))};return InfiniteGameGrid}(I.InfiniteScroll);_.templateSettings={escape:/\{\{(?![&])(.+?)\}\}/g,interpolate:/\{\{&(.+?)\}\}/g,evaluate:/<%([\s\S]+?)%>/g};_.str.formatBytes=function(){var thresholds;thresholds=[["gb",Math.pow(1024,3)],["mb",Math.pow(1024,2)],["kb",1024]];return function(bytes){var j,label,len1,min,ref;for(j=0,len1=thresholds.length;j<len1;j++){ref=thresholds[j],label=ref[0],min=ref[1];if(bytes>=min){return""+_.str.numberFormat(bytes/min)+label}}return _.str.numberFormat(bytes)+" bytes"}}();$.easing.smoothstep=function(t){return t*t*t*(t*(t*6-15)+10)}}).call(this);(function(){$.fn.dispatch=function(event_type,table){this.on(event_type,function(_this){return function(e){var elm,fn,key,res;for(key in table){fn=table[key];elm=$(e.target).closest("."+key);if(!elm.length){continue}if(elm.is(".disabled")){return false}res=fn(elm,e);if(res==="continue"){return}return false}return null}}(this));return this}}).call(this);(function(){var show_images;I.support_passive_scroll=function(){var opts,supports;supports=false;try{opts=Object.defineProperty({},"passive",{get:function(_this){return function(){return supports=true}}(this)});window.addEventListener("test",null,opts)}catch(error){}return supports};I.support_intersection_observer=function(){return"IntersectionObserver"in window};show_images=function(item,make_promise){var cell,cells,fn,images,img,j,len,ref;item.removeClass("lazy_images");cells=item.find("[data-background_image]").addBack("[data-background_image]");images=function(){var j,len,results;results=[];for(j=0,len=cells.length;j<len;j++){cell=cells[j];results.push(function(cell){var image_url;cell=$(cell);image_url=cell.data("background_image");cell.css({backgroundImage:"url("+image_url+")"});if(make_promise){return $.Deferred(function(_this){return function(d){return $("<img />").attr("src",image_url).on("load",function(){return d.resolve()})}}(this))}}(cell))}return results}();ref=item.find("img[data-lazy_src]").addBack("img[data-lazy_src]");fn=function(img){var image_url,srcset;img=$(img);image_url=img.data("lazy_src");img.attr("src",image_url);if(srcset=img.data("lazy_srcset")){img.attr("srcset",srcset)}if(make_promise){return $.Deferred(function(_this){return function(d){return img.on("load",function(){return d.resolve()})}}(this))}};for(j=0,len=ref.length;j<len;j++){img=ref[j];fn(img)}if(make_promise){if(images.length===1){return images[0]}else{return $.when.apply($,images)}}};$.fn.lazy_images=function(opts){var _show_images,check_images,el,handle_intersect,horizontal,io,j,lazy,len,ref,refresh,selector,target,throttled,unbind,win;if(refresh=this.data("lazy_images")){return refresh()}lazy=(opts!=null?opts.elements:void 0)?function(){var j,len,ref,results;ref=opts.elements;results=[];for(j=0,len=ref.length;j<len;j++){el=ref[j];results.push($(el))}return results}():(selector=(opts!=null?opts.selector:void 0)||".lazy_images",function(){var j,len,ref,results;ref=this.find(selector);results=[];for(j=0,len=ref.length;j<len;j++){el=ref[j];results.push($(el))}return results}.call(this));_show_images=(ref=opts!=null?opts.show_images:void 0)!=null?ref:show_images;if(I.support_intersection_observer()){handle_intersect=function(entities){var d,entity,j,len,on_show,results;results=[];for(j=0,len=entities.length;j<len;j++){entity=entities[j];if(entity.isIntersecting){el=entity.target;io.unobserve(el);el=$(el);on_show=opts!=null?opts.show_item:void 0;d=_show_images(el,!!on_show);results.push(typeof on_show==="function"?on_show(el,d):void 0)}else{results.push(void 0)}}return results};io=new IntersectionObserver(handle_intersect,{});for(j=0,len=lazy.length;j<len;j++){el=lazy[j];io.observe(el[0])}return function(){return io.disconnect()}}win=$(window);target=opts!=null?opts.target:void 0;horizontal=opts!=null?opts.horizontal:void 0;unbind=null;check_images=function(_this){return function(){var cuttoff,d,found,i,item,k,len1,on_show,position;cuttoff=function(){if(target){if(horizontal){return target.outerWidth()+target.position().left}else{throw new Error("not yet")}}else{return win.scrollTop()+win.height()}}();found=0;for(i=k=0,len1=lazy.length;k<len1;i=++k){item=lazy[i];if(!item){continue}if(!document.body.contains(item[0])){lazy[i]=null;found+=1;continue}position=function(){if(target){if(horizontal){return item.position().left}else{throw new Error("not yet")}}else{return item.offset().top}}();if(!item[0].offsetParent){continue}if(position<cuttoff){on_show=opts!=null?opts.show_item:void 0;d=_show_images(item,!!on_show);if(typeof on_show==="function"){on_show(item,d)}found+=1;lazy[i]=null}}if(found>0){return lazy=function(){var l,len2,results;results=[];for(l=0,len2=lazy.length;l<len2;l++){el=lazy[l];if(el){results.push(el)}}return results}()}}}(this);throttled=_.throttle(check_images,100);if(target){target.on("scroll",throttled);win.on("resize",throttled);unbind=function(){target.off("scroll",throttled);return win.off("resize","throttled")}}else{if(I.support_passive_scroll()){window.addEventListener("scroll",throttled,{passive:true});win.on("resize i:reshape",throttled);unbind=function(){window.removeEventListener("scroll",throttled,{passive:true});return win.off("resize",throttled)}}else{win.on("scroll resize i:reshape",throttled);unbind=function(){return win.off("scroll resize i:reshape",throttled)}}}this.data("lazy_images",function(_this){return function(){lazy=(opts!=null?opts.elements:void 0)?function(){var k,len1,ref1,results;ref1=opts.elements;results=[];for(k=0,len1=ref1.length;k<len1;k++){el=ref1[k];results.push($(el))}return results}():(selector=(opts!=null?opts.selector:void 0)||".lazy_images",function(){var k,len1,ref1,results;ref1=this.find(selector);results=[];for(k=0,len1=ref1.length;k<len1;k++){el=ref1[k];results.push($(el))}return results}.call(_this));return check_images()}}(this));check_images();return unbind}}).call(this);(function(){$.fn.exists=function(){if(this.length>0){return this}else{return false}}}).call(this);(function(){$.fn.remote_submit=function(fn,validate_fn,more_data){var click_input;click_input=null;this.on("click","button[name], input[type='submit'][name]",function(_this){return function(e){var btn;btn=$(e.currentTarget);if(click_input!=null){click_input.remove()}return click_input=$("<input type='hidden' />").attr("name",btn.attr("name")).val(btn.attr("value")).prependTo(_this)}}(this));return this.on("submit",function(_this){return function(e,callback){var form;e.preventDefault();form=$(e.currentTarget);if(validate_fn){if(!(typeof validate_fn==="function"?validate_fn(form):void 0)){return}}I.remote_submit(form,more_data).done(function(res){form.data("dirty",false);if(callback!=null){return callback(res,form)}else{return fn(res,form)}});return null}}(this))}}).call(this);(function(){$.fn.set_form_errors=function(errors,scroll_to,msg){var base,e,errors_el,errors_list,has_errors,i,len,lightbox;if(scroll_to==null){scroll_to=true}if(msg==null){msg="Errors"}this.find(".form_errors").remove();has_errors=!!(errors!=null?errors.length:void 0);this.toggleClass("has_errors",has_errors);if(has_errors){errors_el=$(_.template('<div class="form_errors">\n  <div>{{ msg }}:</div>\n  <ul></ul>\n</div>')({msg:msg}));errors_list=errors_el.find("ul");for(i=0,len=errors.length;i<len;i++){e=errors[i];errors_list.append($("<li></li>").text(e))}this.prepend(errors_el);if(scroll_to){lightbox=this.closest(".lightbox");if(lightbox.length||this.offset().top>$(window).height()/2){if(typeof(base=this[0]).scrollIntoView==="function"){base.scrollIntoView()}}else{$("html, body").animate({scrollTop:0},"fast")}}}return this}}).call(this);(function(){var slice=[].slice,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.Lightbox=function(){Lightbox.lightbox_container=function(){return this._container||(this._container=$("#lightbox_container").exists()||$('<div id="lightbox_container"></div>').appendTo("body"))};Lightbox.shroud_container=function(){return this._shroud||(this._shroud=$("#lightbox_shroud").exists()||$('<div id="lightbox_shroud"></div>').appendTo("body"))};Lightbox.show_shroud=function(){var shroud;if(this.shroud_visible){return}if(!this._shroud){shroud=this.shroud_container();this.lightbox_container().on("click",function(_this){return function(e){if(!$(e.target).closest(".lightbox").length){if($(e.target).attr("href")==="javascript:void(0)"){return}return _this.close()}}}(this));shroud.on("click",function(_this){return function(){return _this.close()}}(this));$(document.body).on("keydown",function(_this){return function(e){if(e.keyCode===27){e.preventDefault();e.stopPropagation();return _this.close()}else{return _this.on_keydown(e)}}}(this));$(window).on("resize",function(_this){return function(e){return _this.on_resize(e)}}(this))}this.shroud_visible=true;this.shroud_container().addClass("invisible").show();return _.defer(function(_this){return function(){return _this.shroud_container().removeClass("invisible")}}(this))};Lightbox.hide_shroud=function(){this.shroud_visible=false;return this.shroud_container().hide()};Lightbox.open_loading=function(){return this.open_tpl("loading_lightbox",I.Lightbox)};Lightbox.open_remote_react=function(url,init){this.open_loading();return $.when(I.add_react(),$.ajax({dataType:"json",url:url,data:{props:true},xhrFields:{withCredentials:true},error:function(_this){return function(xhr,message,error){var res;res=function(){try{return JSON.parse(xhr.responseText)}catch(error1){}}();if(res!=null?res.errors:void 0){alert(res.errors.join(","))}else{alert("Something went wrong. Please try again later and contact support if it persists.")}return _this.close()}}(this)})).done(function(_this){return function(res,arg){var lb,props;props=arg[0];if(props.errors){alert(props.errors.join(","));_this.close();return}lb=init(props);if(lb){return I.Lightbox.open(lb)}else{return _this.close()}}}(this))};Lightbox.open_remote=function(){var T,args,url;url=arguments[0],T=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];if(T==null){T=I.Lightbox}this.open_loading();return $.ajax({dataType:"json",url:url,data:{lightbox:true},xhrFields:{withCredentials:true},success:function(_this){return function(res){if(res.errors){alert(res.errors.join(","));_this.close();return}return _this.open.apply(_this,[res.content,T].concat(slice.call(args)))}}(this),error:function(_this){return function(xhr,message,error){alert("Something went wrong. Please try again later and contact support if it persists.");return _this.close()}}(this)})};Lightbox.open_tpl=function(){var args,el,tpl;tpl=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[];el=$("#"+tpl+"_tpl");if(!el.length){throw"missing template for lightbox: "+tpl}return this.open.apply(this,[el.html()].concat(slice.call(args)))};Lightbox.open_tpl_with_params=function(){var args,el,html,params,tpl;tpl=arguments[0],params=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];el=$("#"+tpl+"_tpl");if(!el.length){throw"missing template for lightbox: "+tpl}html=_.template(el.html())(params);return this.open.apply(this,[html].concat(slice.call(args)))};Lightbox.open=function(){var T,args,content,lightbox,lightbox_el,new_obj;content=arguments[0],T=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];if(T==null){T=I.Lightbox}if(this.current_lightbox){this.current_lightbox.close();this.current_lightbox=null}new_obj=false;if(content.$$typeof){new_obj=true;lightbox=new I.ReactLightbox(content,this)}else{if("string"===typeof content){content=$.trim(content)}lightbox_el=$(content);if(!(lightbox=lightbox_el.data("object"))){new_obj=true;lightbox=function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(T,[lightbox_el,this].concat(slice.call(args)),function(){});lightbox_el.data("object",lightbox)}}$(document.body).addClass("lightbox_open");this.show_shroud();lightbox.show(new_obj);this.current_lightbox=lightbox;return lightbox};Lightbox.close=function(){var ref;if(this.current_lightbox&&!this.current_lightbox.is_closable()){return}if(this.current_lightbox&&this.current_lightbox.el.is(".has_changes")){if(!confirm("You've have unsaved changes in this dialog. Are you sure you want to close it?")){return}}this.hide_shroud();if((ref=this.current_lightbox)!=null){ref.close()}this.current_lightbox=null;return $(document.body).removeClass("lightbox_open")};Lightbox.on_keydown=function(e){var ref,ref1;return(ref=this.current_lightbox)!=null?(ref1=ref.el)!=null?ref1.trigger("i:lightbox_keydown",e):void 0:void 0};Lightbox.on_resize=function(e){var ref,ref1;return(ref=this.current_lightbox)!=null?(ref1=ref.el)!=null?ref1.trigger("i:lightbox_resize",e):void 0:void 0};Lightbox.prototype.lightbox_hidden=function(lb){};function Lightbox(){var el,parent1,rest;el=arguments[0],parent1=arguments[1],rest=3<=arguments.length?slice.call(arguments,2):[];this.parent=parent1;this.el=$(el);this.el.on("click",".close_button, .close_btn",function(_this){return function(e){I.Lightbox.close();return false}}(this));this.init.apply(this,rest)}Lightbox.prototype.init=function(){};Lightbox.prototype.first_show=function(){};Lightbox.prototype.with_selectize=function(fn){var html;if(!$.fn.selectize){html=this.el.data().selectize;if(!html){throw"missing selectize include in lightbox"}$("head").append(html)}return I.with_selectize(fn)};Lightbox.prototype.with_redactor=function(fn){var html;if(!$.fn.redactor){html=this.el.data().redactor;if(!html){throw"missing redactor include in lightbox"}$("head").append(html)}return I.with_redactor(fn)};Lightbox.prototype.show=function(first_time){var el,i,len,ref;this.el.add(this.parent.shroud_container()).add(this.parent.lightbox_container()).toggleClass("mobile_lb",$(window).width()<=600);this.el.appendTo(this.parent.lightbox_container()).addClass("animated").show().trigger("i:lightbox_open");this.position();if(first_time){ref=this.el.find("[data-js_init]");for(i=0,len=ref.length;i<len;i++){el=ref[i];eval($(el).data("js_init"))}return this.first_show()}};Lightbox.prototype.replace_content=function(c){var content;content=this.el.find(".content");content.empty();content.append(c);return this.position()};Lightbox.prototype.replace_title=function(title){this.el.find(".lightbox_title").html(title);return this.position()};Lightbox.prototype.add_css_class=function(c){return this.el.addClass(c)};Lightbox.prototype.remove_css_class=function(c){return this.el.removeClass(c)};Lightbox.prototype.close=function(){this.el.add(Lightbox.shroud_container()).add(Lightbox.lightbox_container()).removeClass("mobile_lb");return this.el.removeClass("animated").hide().trigger("i:lightbox_close").remove()};Lightbox.prototype.position=function(){var top;if(this.el.is(".mobile_lb")){return this.el.css({"margin-left":""})}else{top="fixed"===this.parent.lightbox_container().css("position")?"":$(window).scrollTop()+80+"px";return this.el.css({position:"absolute",top:top,"margin-left":-this.el.outerWidth()/2+"px"})}};Lightbox.prototype.closable=true;Lightbox.prototype.is_closable=function(){return this.closable};return Lightbox}();I.CenterLighbox=function(superClass){extend(CenterLighbox,superClass);function CenterLighbox(){this.position=bind(this.position,this);return CenterLighbox.__super__.constructor.apply(this,arguments)}CenterLighbox.prototype.position=function(){return this.el.css({position:"fixed",left:"50%",top:"50%","margin-left":-this.el.outerWidth()/2+"px","margin-top":-this.el.outerHeight()/2+"px"})};return CenterLighbox}(I.Lightbox);I.ReactLightbox=function(superClass){extend(ReactLightbox,superClass);function ReactLightbox(){var base,component,el,parent,rest,wrapper;component=arguments[0],parent=arguments[1],rest=3<=arguments.length?slice.call(arguments,2):[];wrapper=$('<div class="react_lightbox"></div>').appendTo(parent.lightbox_container());this.react_component=ReactDOM.render(component,wrapper[0]);el=ReactDOM.findDOMNode(this.react_component);ReactLightbox.__super__.constructor.apply(this,[el,parent].concat(slice.call(rest)));this.react_component.setState({lightbox:this});if(typeof(base=this.react_component).lightbox_initialized==="function"){base.lightbox_initialized()}}ReactLightbox.prototype.show=function(first_time){this.el.addClass("animated");return this.position()};ReactLightbox.prototype.close=function(){var parent;this.el.trigger("i:lightbox_close");parent=this.el.parent();ReactDOM.unmountComponentAtNode(parent[0]);return parent.remove()};return ReactLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.Header=function(){Header.prototype.track_category="header";function Header(el){this.setup_browse_menu=bind(this.setup_browse_menu,this);this.el=$(el);I.tracked_links(this.el,this.track_category,"click");this.el.on("click",".menu_tick",function(_this){return function(e){var body,menu,target;if($(e.target).closest(".drop_menu").length){return}target=$(e.currentTarget);menu=target.closest(".drop_menu_wrap").toggleClass("open");body=$(document.body);if(menu.is(".open")){target.trigger("i:track_link");return body.on("click.drop_menu",function(e){if($(e.target).closest(menu).length){return}menu.removeClass("open");return body.off("click.drop_menu")})}else{return body.off("click.drop_menu")}}}(this));this.setup_browse_menu()}Header.prototype.setup_browse_menu=function(){var browse_button;browse_button=this.el.find(".browse_btn");this.browse_menu=new I.HoverManager({timeout:750,enter_timeout:100,show:function(_this){return function(){_this.el.addClass("hover_menu_open");browse_button.addClass("open");return setTimeout(function(){return _this.el.addClass("hover_menu_visible")},0)}}(this),hide:function(_this){return function(){browse_button.removeClass("open");return _this.el.removeClass("hover_menu_visible")}}(this),after_fade:function(_this){return function(){return _this.el.removeClass("hover_menu_open")}}(this)});$(document.body).on("click",function(_this){return function(e){var c;c=$(e.target).closest(".browse_btn, .header_dropdown");if(c.length){return}_this.browse_menu.hide()}}(this));return this.el.on("mouseenter mouseleave",".browse_btn, .header_dropdown",function(_this){return function(e){if(e.type==="mouseenter"){return _this.browse_menu.enter()}else{return _this.browse_menu.leave()}}}(this))};return Header}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.HoverManager=function(){HoverManager.prototype.default_opts={timeout:1e3,enter_timeout:150,fade_timeout:400,show:function(){},hide:function(){},after_fade:function(){}};function HoverManager(opts){this._clear_enter_timeout=bind(this._clear_enter_timeout,this);this._clear_fade_timeout=bind(this._clear_fade_timeout,this);this._clear_leave_timeout=bind(this._clear_leave_timeout,this);this.opts=$.extend({},this.default_opts,opts);this.open=false}HoverManager.prototype.enter=function(){if(this.enter_timeout){return}this._clear_leave_timeout();this._clear_fade_timeout();return this.enter_timeout=window.setTimeout(function(_this){return function(){var base;delete _this.enter_timeout;if(!_this.open){if(typeof(base=_this.opts).show==="function"){base.show()}}return _this.open=true}}(this),this.opts.enter_timeout)};HoverManager.prototype.leave=function(){if(this.leave_timeout){return}this._clear_enter_timeout();return this.leave_timeout=window.setTimeout(function(_this){return function(){delete _this.leave_timeout;return _this.hide()}}(this),this.opts.timeout)};HoverManager.prototype.hide=function(){var base;this._clear_enter_timeout();this._clear_leave_timeout();if(this.open){if(typeof(base=this.opts).hide==="function"){base.hide()}}this.open=false;this.hiding=true;return this.fade_timeout=window.setTimeout(function(_this){return function(){var base1;if(typeof(base1=_this.opts).after_fade==="function"){base1.after_fade()}return _this.hiding=false}}(this),this.opts.fade_timeout)};HoverManager.prototype.show=function(){var base;return typeof(base=this.opts).show==="function"?base.show():void 0};HoverManager.prototype._clear_leave_timeout=function(){if(this.leave_timeout){window.clearTimeout(this.leave_timeout);return delete this.leave_timeout}};HoverManager.prototype._clear_fade_timeout=function(){if(this.fade_timeout){window.clearTimeout(this.fade_timeout);return delete this.fade_timeout}};HoverManager.prototype._clear_enter_timeout=function(){if(this.enter_timeout){window.clearTimeout(this.enter_timeout);return delete this.enter_timeout}};return HoverManager}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.GameGridSizer=function(){GameGridSizer.prototype.selector=".game_grid_widget .game_cell .game_thumb";GameGridSizer.prototype.width_selector=".game_grid_widget .game_cell";GameGridSizer.prototype.expected_size=315;GameGridSizer.prototype.aspect_ratio=315/250;GameGridSizer.prototype.cell_margin=20;GameGridSizer.prototype.no_right_margin=false;GameGridSizer.prototype.min_columns=1;GameGridSizer.prototype.double=false;GameGridSizer.sizers={el_width:function(){var fraction_el,out,r,ref;fraction_el=(ref=this.el[0])!=null?ref.getBoundingClientRect().width:void 0;r=fraction_el-Math.floor(fraction_el);out=Math.floor(this.el.width());if(r>0){out-=1}return out},el_rect:function(){var ref;return Math.floor(((ref=this.el[0])!=null?ref.getBoundingClientRect().width:void 0)||0)}};GameGridSizer.initialize=_.once(function(){var body,disable_details,enable_details;body=$(document.body);disable_details=_.debounce(function(){return body.addClass("disable_hover")},200,true);enable_details=_.debounce(function(){return body.removeClass("disable_hover")},200);return $(window).on("scroll resize",function(){disable_details();enable_details()})});function GameGridSizer(opts){if(opts==null){opts={}}this.available_width=bind(this.available_width,this);this.on_size=bind(this.on_size,this);$.extend(this,opts);this.size_callbacks=[];this.constructor.initialize();$(window).on("resize",_.debounce(function(_this){return function(){return _this.resize_cells()}}(this),200));this.resize_cells();if(!I.in_test){_.defer(function(_this){return function(){return _this.resize_cells()}}(this))}}GameGridSizer.prototype.on_size=function(fn){return this.size_callbacks.push(fn)};GameGridSizer.prototype.available_width=function(){return $(window).width()};GameGridSizer.prototype.resize_cells=function(expected_width){var callback,css,i,len,new_height,new_width,num_cells,page_width,real_num_cells,real_width,ref,results;if(expected_width==null){expected_width=this.expected_size}real_width=expected_width+this.cell_margin;page_width=this.available_width();if(this.no_right_margin){page_width+=this.cell_margin}num_cells=page_width/real_width;real_num_cells=Math.ceil(num_cells);if(real_num_cells<this.min_columns){real_num_cells=this.min_columns}new_width=page_width/real_num_cells-this.cell_margin;new_height=new_width/this.aspect_ratio;new_width=Math.floor(new_width);new_height=Math.floor(new_height);this.cells_per_row=real_num_cells;if(this._style){this._style.remove()}css=this.selector+" {\n  width: "+new_width+"px;\n  height: "+new_height+"px;\n}";if(this.no_right_margin&&this.width_selector){css+=this.width_selector+":nth-child("+real_num_cells+"n) {\n  margin-right: 0;\n}"}if(this.width_selector){css+=this.width_selector+" {\n  width: "+new_width+"px;\n}"}this._style=$("<style type='text/css'>"+css+"</style>").appendTo($("head"));ref=this.size_callbacks;results=[];for(i=0,len=ref.length;i<len;i++){callback=ref[i];results.push(callback(this,new_width,new_height))}return results};return GameGridSizer}();I.GameCells=function(){function GameCells(el){this.setup_game_tools=bind(this.setup_game_tools,this);this.el=$(el);this.setup_game_tools();this.setup_gifs()}GameCells.prototype.setup_game_tools=function(){return this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){I.event("grid",I.page_name(),"add_to_collection");if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this)})};GameCells.prototype.setup_gifs=function(){return this.el.on("mouseenter",".game_cell",function(_this){return function(e){var el,gif_overlay;el=$(e.currentTarget);if(el.data("grid_hovered")){return}el.data("grid_hovered",true);gif_overlay=el.find(".gif_overlay");if(!gif_overlay.length){return}return gif_overlay.css("background-image","url("+gif_overlay.data("gif")+")")}}(this))};return GameCells}();I.GameGrid=function(){function GameGrid(el,opts){var copy_fields,field,i,is_css_grid,len,size_opts;if(opts==null){opts={}}this.refresh_images=bind(this.refresh_images,this);this.add_image_loading=bind(this.add_image_loading,this);this.setup_conversion_tracking=bind(this.setup_conversion_tracking,this);this.el=$(el);$.extend(this,opts);this.setup_lazy_images();if(this.show_popups!==false){new I.GamePopups(this.el)}new I.GameCells(this.el);is_css_grid=this.el.is(".layout_grid");if(!this.sizer&&this.sizer!==false&&!is_css_grid){copy_fields=["selector","width_selector","expected_size","min_columns","cell_margin","available_width"];size_opts={el:this.el,available_width:I.GameGridSizer.sizers.el_width};for(i=0,len=copy_fields.length;i<len;i++){field=copy_fields[i];if(field in opts){size_opts[field]=opts[field]}}this.sizer=new I.GameGridSizer(size_opts);this.sizer.on_size(function(_this){return function(){_this.el.trigger("i:grid_resize");return _this.el.lazy_images()}}(this))}}GameGrid.prototype.setup_lazy_images=function(){return _.defer(function(_this){return function(){return _this.add_image_loading()}}(this))};GameGrid.prototype.setup_conversion_tracking=function(source){this.el.on("i:impression",function(_this){return function(e){var conversion_el,game_id;conversion_el=$(e.target).closest("[data-game_id]");game_id=conversion_el.data("game_id");if(!game_id){return}return I.ConversionTracker.push("1:"+source+":1:"+game_id)}}(this));return this.el.on("i:delegate_tracking",function(_this){return function(e,push){var game_id;game_id=$(e.target).closest("[data-game_id]").data("game_id");if(!game_id){return}I.ConversionTracker.click(source+":1:"+game_id);return push(I.ConversionTracker.flush_now())}}(this))};GameGrid.prototype.add_image_loading=function(){return this.el.lazy_images({show_item:function(_this){return function(item){item.trigger("i:impression");return item.find(".image_loading").addBack(".image_loading").removeClass("image_loading")}}(this)})};GameGrid.prototype.refresh_images=function(){var base;return typeof(base=this.el.data("lazy_images"))==="function"?base():void 0};return GameGrid}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.GamePopups=function(){GamePopups.prototype.trigger_selector=".game_thumb";GamePopups.prototype.popup_selector=".popup_details";GamePopups.prototype.hover_delay=250;GamePopups.prototype.close_timeout=200;GamePopups.prototype.x_offset=0;function GamePopups(el,opts){var body;if(opts==null){opts={}}this.deferred_for_el=bind(this.deferred_for_el,this);if(I.is_mobile()){return}this.el=$(el);$.extend(this,opts);body=$(document.body);this.el.on("mouseenter mouseleave",this.trigger_selector,function(_this){return function(e){el=$(e.currentTarget);if(el.closest(".jam_cell").length){return}if(el.closest(".disable_hover").length){return}if(e.type==="mouseenter"){return _this.enter(el)}else{return _this.leave(el)}}}(this));body.on("i:hide_popups",function(_this){return function(e,hm){return _this.close_popup()}}(this));body.on("i:hide_other_popups",function(_this){return function(e,hm){if(hm===_this){return}return _this.close_popup()}}(this))}GamePopups.prototype.deferred_for_el=function(el){var defer,game_id,popup_url;defer=el.data("i:popup_defer");if(!defer){game_id=el.closest("[data-game_id]").data("game_id");defer=$.Deferred();el.data("i:popup_defer",defer);if(!game_id){return}popup_url=I.subdomain?"/-/game/popup/"+game_id:"/game/popup/"+game_id;$.get(popup_url,function(_this){return function(popup_html){var popup;if(_.isObject(popup_html)&&popup_html.errors){return}popup=$(popup_html);popup.data("object_id",game_id);I.tracked_links(popup,"popups",I.page_name(),"click");popup.find("a").on("click",function(){var trigger;if(trigger=popup.data("trigger_el")){return trigger.trigger("i:track_link")}});return defer.resolve(popup)}}(this))}return defer};GamePopups.prototype.enter=function(el){var fast,slow;el.data("i:inside",true);slow=_.debounce(function(_this){return function(){if(!el.data("i:inside")){return}return _this.deferred_for_el(el).then(function(popup_el){return _this.show_popup(el,popup_el)})}}(this),this.hover_delay);fast=_.debounce(function(_this){return function(){var start;if(!el.data("i:inside")){return}start=new Date;return _this.deferred_for_el(el)}}(this),this.hover_delay/2);return el.on("mousemove.hover_manager",function(){slow();return fast()})};GamePopups.prototype.leave=function(el){el.data("i:inside",false);return el.off("mousemove.hover_manager")};GamePopups.prototype.show_popup=function(el,popup_el){var fn,i,j,len,ref,s,screenshots;if(this.current_popup===popup_el){return}this.el.trigger("i:hide_other_popups",[this]);if((ref=this.current_popup)!=null){ref.stop().remove()}this.current_popup=popup_el.css({left:"0px",top:"0px"}).removeClass("visible");screenshots=popup_el.find(".popup_screenshot").removeClass("visible");$(document.body).append(popup_el);this.position_popup(el,popup_el);_.defer(function(_this){return function(){return popup_el.addClass("visible")}}(this));popup_el.data("trigger_el",el);fn=function(_this){return function(s){return setTimeout(function(){return s.addClass("visible")},i*100)}}(this);for(i=j=0,len=screenshots.length;j<len;i=++j){s=screenshots[i];fn($(s))}popup_el.hide().css({opacity:""}).fadeIn("fast");return this.watch_for_popup_close()};GamePopups.prototype.watch_for_popup_close=function(){var close_timeout,target_selector;target_selector=this.trigger_selector+", "+this.popup_selector;close_timeout=null;$(document.body).on("click.hover_manager",function(_this){return function(e){var target;target=$(e.target);if(target.closest(target_selector).length){return}return _this.close_popup()}}(this));return $(window).on("mousemove.hover_manager",_.throttle(function(_this){return function(e){var inside;inside=$(e.target).closest(target_selector);if(inside.length){if(close_timeout){window.clearTimeout(close_timeout);close_timeout=null}return}if(!close_timeout){return close_timeout=window.setTimeout(function(){return _this.close_popup()},_this.close_timeout)}}}(this),50))};GamePopups.prototype.position_popup=function(el,popup){var height,left,offset,target_height,target_width,top,width;offset=el.offset();width=popup.outerWidth(true);height=popup.outerHeight(true);popup.removeClass("on_right");target_height=el.outerHeight();target_width=el.outerWidth();top=offset.top+(target_height-height)/2;left=offset.left-width;if(left<0){left=offset.left+target_width;left+=this.x_offset;popup.addClass("on_right")}else{left-=this.x_offset}return popup.css({top:Math.floor(top)+"px",left:Math.floor(left)+"px"})};GamePopups.prototype.close_popup=function(){var ref;$(window).off("mousemove.hover_manager");$(document.body).off("click.hover_manager");if((ref=this.current_popup)!=null){ref.stop(true).remove()}return this.current_popup=null};return GamePopups}();I.GamePopup=function(){function GamePopup(el){this.el=$(el);this.el.dispatch("click",{watch_trailer_btn:function(btn){I.event("grid",I.page_name(),"watch_trailer");return I.Lightbox.open_remote(btn.data("lightbox_url"))}})}return GamePopup}();I.WatchTrailerLightbox=function(){function WatchTrailerLightbox(el){this.el=$(el);this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){I.event("grid","trailer","add_to_collection");if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this)})}return WatchTrailerLightbox}()}).call(this);(function(){var slice=[].slice;I.ConversionTracker=function(){function ConversionTracker(){}ConversionTracker.types={impression:1,click:2,purchase:3,download:4};ConversionTracker.buffer=[];ConversionTracker.find_click=function(suffix){var ca,ev,i,item,len,pattern;pattern=new RegExp(":"+suffix+"$");ca=this.get_cookie();for(i=0,len=ca.length;i<len;i++){item=ca[i];ev=_.isArray(item)?item[0]:item;if(ev.match(pattern)){return item}}};ConversionTracker.strip_click=function(suffix){var ca,ev,item,new_ca,pattern,removed;pattern=new RegExp(":"+suffix+"$");ca=this.get_cookie();removed=0;new_ca=function(){var i,len,results;results=[];for(i=0,len=ca.length;i<len;i++){item=ca[i];ev=_.isArray(item)?item[0]:item;if(ev.match(pattern)){removed+=1;continue}results.push(item)}return results}();if(new_ca.length===ca.length){return 0}this.write_cookie(new_ca);return removed};ConversionTracker.after_click_action=function(type,suffix){var click,msg,original_msg,split_tests;click=this.find_click(suffix);if(!click){return}split_tests=null;original_msg=_.isArray(click)?(split_tests=click[1],click[0]):click;msg=original_msg.replace(/^\d+/,this.types[type]);this.strip_click(suffix);this.push(msg,split_tests);return true};ConversionTracker.download=function(suffix){return this.after_click_action("download",suffix)};ConversionTracker.purchase=function(suffix){return this.after_click_action("purchase",suffix)};ConversionTracker.click=function(suffix){var c,ca,msg,msg_with_split,other_msg,splits;msg=this.types.click+":"+suffix;msg_with_split=(splits=this.get_active_splits())?[msg,splits]:msg;this.push(msg);try{ca=function(){var i,len,ref,results;ref=this.get_cookie();results=[];for(i=0,len=ref.length;i<len;i++){c=ref[i];other_msg=_.isArray(c)?c[0]:c;if(other_msg===msg){continue}results.push(c)}return results}.call(this);ca.push(msg_with_split);while(ca.length>100){ca.shift()}this.write_cookie(ca);return true}catch(error){}};ConversionTracker.write_cookie=function(ca){return I.set_cookie("itchio_ca",JSON.stringify(ca),{expires:1})};ConversionTracker.get_cookie=function(){var ca;ca=Cookies.get("itchio_ca");if(ca){try{return JSON.parse(ca)||[]}catch(error){try{return JSON.parse(decodeURIComponent(ca))||[]}catch(error){return[]}}}else{return[]}};ConversionTracker.flush_later=function(){this.flush_later=_.throttle(this.flush_now,2e3,{leading:false});$(window).on("beforeunload",function(_this){return function(){_this.flush_now();return void 0}}(this));return this.flush_later()};ConversionTracker.encode_buffer=function(buffer){var _,ca,i,id,last_obj_type,last_source,last_type,len,obj_id,obj_type,out,p,ref,source,type;if(buffer==null){buffer=slice.call(this.buffer)}buffer.sort();out=[];last_type=null;last_source=null;last_obj_type=null;for(i=0,len=buffer.length;i<len;i++){ca=buffer[i];ref=ca.match(/^(\d+):(\d+):(\d+):(\d+)$/),_=ref[0],type=ref[1],source=ref[2],obj_type=ref[3],obj_id=ref[4];if(!type){continue}if(type!==last_type){out.push("t"+type);last_type=type}if(source!==last_source){out.push("s"+source);last_source=source}if(obj_type!==last_obj_type){out.push("o"+obj_type);last_obj_type=obj_type}id=(+obj_id).toString(36);p=String.fromCharCode("A".charCodeAt(0)+id.length);out.push(""+p+id)}return out.join("")};ConversionTracker.get_active_splits=function(){return I.active_splits};ConversionTracker.flush_url=function(split_tests){var params,splits,x;x=this.encode_buffer();params=[{name:"x",value:x}];if(splits=split_tests||this.get_active_splits()){params.push({name:"s",value:splits.join(",")})}return I.root_url("ca.gif")+"?"+$.param(params)};ConversionTracker.flush_now_beacon=function(split_tests){var url;if(navigator.sendBeacon==null){return this.flush_now(split_tests)}if(this.buffer.length){if(I.in_dev){console.debug.apply(console,["ca(beacon)"].concat(slice.call(_.compact([this.buffer,split_tests]))))}url=this.flush_url(split_tests);if(navigator.sendBeacon(url)){this.buffer=[]}else{return this.flush_now()}}return $.when()};ConversionTracker.flush_now=function(split_tests){var url;if(!this.buffer.length){return $.when()}if(I.in_dev){console.debug.apply(console,["ca"].concat(slice.call(_.compact([this.buffer,split_tests]))))}url=this.flush_url(split_tests);this.buffer=[];return $.Deferred(function(_this){return function(d){var done,img;img=new Image;img.src=url;done=function(){return d.resolve()};img.onerror=done;return img.onload=done}}(this))};ConversionTracker.push=function(msg,split_tests){var v;this.buffer=function(){var i,len,ref,results;ref=this.buffer;results=[];for(i=0,len=ref.length;i<len;i++){v=ref[i];if(v!==msg){results.push(v)}}return results}.call(this);this.buffer.push(msg);if(this.buffer.length>50||split_tests){return this.flush_now(split_tests)}else{return this.flush_later()}};return ConversionTracker}()}).call(this);(function(){I.ReferrerTracker=function(){function ReferrerTracker(){}ReferrerTracker.MAX_ITEMS=20;ReferrerTracker.get_cookie=function(){return Cookies.getJSON("itchio_refs")||[]};ReferrerTracker.write_cookie=function(val){return I.set_cookie("itchio_refs",val,{expires:14})};ReferrerTracker.has_ref=function(type,id){var cid,ctype,i,len,ref,ref1;id=+id;ref=ReferrerTracker.get_cookie();for(i=0,len=ref.length;i<len;i++){ref1=ref[i],ctype=ref1[0],cid=ref1[1];if(ctype===type&&cid===id){return true}}return false};ReferrerTracker.push=function(type,id,value){var r,refs;if(!(value&&value.length>0)){return}id=+id;refs=function(){var i,len,ref,results;ref=this.get_cookie();results=[];for(i=0,len=ref.length;i<len;i++){r=ref[i];if(r[0]===type&&r[1]===id){continue}results.push(r)}return results}.call(ReferrerTracker);if(I.in_dev){console.log("pushing referrer",[type,id,value])}refs.unshift([type,id,value]);while(refs.length>ReferrerTracker.MAX_ITEMS){refs.pop()}return ReferrerTracker.write_cookie(refs)};return ReferrerTracker}()}).call(this);(function(){I.FilterPickers=function(){FilterPickers.prototype.label_padding=10;function FilterPickers(el,opts){var all_pickers,hide_all_pickers;this.opts=opts!=null?opts:{};this.el=$(el);all_pickers=this.el.find(".filter_picker_widget");if(this.opts.label_padding){this.label_padding=this.opts.label_padding}hide_all_pickers=function(_this){return function(){return all_pickers.removeClass("open popup_visible").find(".filter_options").css({marginTop:""})}}(this);$(window).on("click",function(_this){return function(e){if($(e.target).closest(".filter_picker_widget").length){}else{return hide_all_pickers()}}}(this));this.el.on("i:close_filter_pickers",hide_all_pickers);this.el.on("click",".filter_picker_widget .filter_value",function(_this){return function(e){var height,picker,right_space;e.preventDefault();picker=$(e.currentTarget).closest(".filter_picker_widget");picker.trigger("i:track_link");all_pickers.not(picker).removeClass("open popup_visible");picker.toggleClass("open");height=picker.find(".filter_value").height();picker.find(".filter_options").css({marginTop:height+_this.label_padding*2,minWidth:picker.width()+30+"px"});right_space=$(window).width()-picker.position().left+picker.width();picker.toggleClass("popup_left",right_space<200);return _.defer(function(){return picker.toggleClass("popup_visible",picker.is(".open"))})}}(this))}return FilterPickers}()}).call(this);(function(){var render_lightbox;render_lightbox=function(props){var abbr,code,details,div,h2,p,pre,summary,table,tbody,td,thead,total_queries,total_time,tr;table=ReactDOMFactories.table,thead=ReactDOMFactories.thead,tbody=ReactDOMFactories.tbody,tr=ReactDOMFactories.tr,td=ReactDOMFactories.td,abbr=ReactDOMFactories.abbr,details=ReactDOMFactories.details,summary=ReactDOMFactories.summary,div=ReactDOMFactories.div,h2=ReactDOMFactories.h2,code=ReactDOMFactories.code,pre=ReactDOMFactories.pre,p=ReactDOMFactories.p;total_queries=props.query_log.length;total_time=props.query_log.reduce(function(v,row){return v+row[1]},0);return R.Lightbox({className:"compact perf_query_log_widget",style:{width:"100%",maxWidth:"800px"}},h2({},"Query log"),p({style:{margin:"0 10px"}},"Queries: ",code({},total_queries),", Time: ",code({},(total_time*1e3).toFixed(2)+"ms")),div({style:{padding:"10px"}},table({className:"nice_table",style:{width:"100%"}},thead({},tr({},td({},"Query"),td({},"Timing"))),tbody({},props.query_log.map(function(_this){return function(arg,idx){var query,time_ms,time_sec;query=arg[0],time_sec=arg[1];time_ms=time_sec*1e3;return tr({key:idx},td({},details({},summary({},code({style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block",maxWidth:"600px"}},query)),pre({style:{whiteSpace:"pre-wrap"}},query))),td({},code({style:{fontWeight:time_ms>10?"bold":void 0,color:time_ms>100?"white":time_ms>50?"red":void 0,backgroundColor:time_ms>100?"red":void 0}},time_ms.toFixed(2)+"ms")))}}(this))))))};I.PerfPanel=function(){function PerfPanel(data){var tpl;data.layout_time||(data.layout_time=0);data.view_time||(data.view_time=0);data.db_time||(data.db_time=0);data.db_count||(data.db_count=0);tpl=_.template('<div class="perf_panel">\n  <div class="stat_row">\n    <strong>Queries:</strong> {{ db_count }}\n  </div>\n\n  <div class="stat_row">\n    <strong>Query time:</strong> {{ Math.floor(db_time * 1000) }}ms\n  </div>\n\n  <div class="stat_row">\n    <strong>View time:</strong> {{ Math.floor((view_time + layout_time) * 1000) }}ms\n  </div>\n\n  <div class="stat_row">\n    <strong>Rest:</strong> {{ Math.floor((total_time - (view_time + layout_time + db_time)) * 1000) }}ms\n  </div>\n\n</div>');this.data=data;this.el=$(tpl(data)).appendTo(document.body);this.el.on("click",function(_this){return function(){return _this.render_queries()}}(this))}PerfPanel.prototype.render_queries=function(){var query,tbl,time_sec;if(!this.data.query_log){return}tbl=function(){var i,len,ref,ref1,results;ref=this.data.query_log;results=[];for(i=0,len=ref.length;i<len;i++){ref1=ref[i],query=ref1[0],time_sec=ref1[1];results.push({query:query,time:time_sec*1e3})}return results}.call(this);console.table(tbl);return I.add_react().done(function(_this){return function(){if(typeof R!=="undefined"&&R!==null?R.Lightbox:void 0){return I.Lightbox.open(render_lightbox({query_log:_this.data.query_log}))}}}(this))};return PerfPanel}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.BrowseRelatedTags=function(){function BrowseRelatedTags(el,opts){this.opts=opts;this.setup_tag_dropdown=bind(this.setup_tag_dropdown,this);this.el=$(el);I.libs.selectize.done(function(_this){return function(){return _this.setup_tag_dropdown()}}(this))}BrowseRelatedTags.prototype.setup_tag_dropdown=function(){var append_path,selectize,set_loading;set_loading=function(){selectize.disable();selectize.settings.placeholder="Loading...";return selectize.updatePlaceholder()};append_path=function(path){var current;current=window.location.pathname;return window.location=(current+path).replace(/\/\/+/,"/")};return selectize=this.el.find(".tag_selector").selectize({maxItems:1,placeholder:"Select a tag...",createFilter:function(_this){return function(value){if(value.length>30){return false}return I.slugify(value,{for_tags:true})!==""}}(this),create:function(_this){return function(value,callback){return callback({name:value,url:"/tag-"+I.slugify(value)})}}(this),onChange:function(_this){return function(value){set_loading();return _this.fetch_tags.done(function(tags){var i,len,tag;for(i=0,len=tags.length;i<len;i++){tag=tags[i];if(tag.name===value){append_path(tag.url);return}}return append_path("/tag-"+I.slugify(value,{for_tags:true}))})}}(this),onFocus:function(_this){return function(){return _this.fetch_tags||(_this.fetch_tags=$.Deferred(function(d){var fetch_tags;fetch_tags=$.getJSON(_this.opts.tags_url);selectize.load(function(callback){return fetch_tags.done(function(res){if(res.tags){return callback(res.tags)}else{return callback([])}})});return fetch_tags.done(function(res){return d.resolve(res.tags)})}))}}(this),valueField:"name",labelField:"name",searchField:["name"],render:{option_create:function(data,escape){return'<div class="create">Filter with <strong>'+escape(data.input)+"</strong>&hellip;</div>"}}})[0].selectize};return BrowseRelatedTags}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.Browse=function(superClass){extend(Browse,superClass);Browse.prototype.link_track_category="browse";Browse.prototype.method="get";Browse.prototype.setup_loading=function(){if(this.opts.disable_infinite_scroll){return}return Browse.__super__.setup_loading.apply(this,arguments)};function Browse(el,opts){var grid;this.opts=opts;this.setup_loading=bind(this.setup_loading,this);Browse.__super__.constructor.call(this,el);this.current_page=this.opts.current_page;new I.FilterPickers(this.el);grid=this.el.find(".browse_game_grid");this.grid=new I.GameGrid(grid,{selector:".browse_game_grid .game_cell .game_thumb",width_selector:".browse_game_grid .game_cell",cell_margin:10,expected_size:300});this.grid.setup_conversion_tracking("2");I.format_dates(this.el,"fromNow");I.setup_grid_referrers(this.el,function(_this){return function(){return _this.serialize_page_name()}}(this));I.deferred_links(this.el,"a[data-label]");this.el.on("i:delegate_tracking",function(_this){return function(e,push){return push(I.ga_tracker(_this.link_track_category)($(e.target)))}}(this));this.el.on("click",".grid_column_outer",function(_this){return function(){if(_this.el.is(".filters_shown")){return _this.el.removeClass("filters_shown")}}}(this));this.el.dispatch("click",{suggest_description_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("lightbox_url"),I.SuggestTagDescriptionLightbox)}}(this),filter_label:function(_this){return function(label){var $group;if($(label.context).closest(".filter_clear").length){return"continue"}$group=label.closest(".filter_group");if(!$group.hasClass("always_shown")){return $group.toggleClass("shown")}}}(this),toggle_more:function(_this){return function(label){var $group;$group=label.closest(".filter_group");if(!$group.hasClass("always_shown")){return $group.toggleClass("shown")}}}(this),mobile_filter_btn:function(_this){return function(){return _this.el.toggleClass("filters_shown")}}(this)})}Browse.prototype.serialize_page_name=function(){var key,name,parts;name="browse:";if(this.opts.facets){parts=function(){var results;results=[];for(key in this.opts.facets){results.push(key+":"+this.opts.facets[key])}return results}.call(this);parts.sort(function(a,b){return a[0].localeCompare(b[0])});name+=parts.join(",")}return name};return Browse}(I.InfiniteGameGrid);I.BrowseTags=function(){function BrowseTags(el){this.el=$(el);this.el.dispatch("click",{suggest_description_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("lightbox_url"),I.SuggestTagDescriptionLightbox)}}(this)});this.el.lazy_images();this.el.find(".tag_selector").selectize({sortField:"text",maxItems:1,onChange:function(_this){return function(value){return window.location=value}}(this)})}return BrowseTags}();I.SuggestTagDescriptionLightbox=function(superClass){extend(SuggestTagDescriptionLightbox,superClass);function SuggestTagDescriptionLightbox(){this.init=bind(this.init,this);return SuggestTagDescriptionLightbox.__super__.constructor.apply(this,arguments)}SuggestTagDescriptionLightbox.prototype.init=function(){var form;return form=this.el.find("form").remote_submit(function(_this){return function(res){var errors;form.toggleClass("has_errors",!!res.errors);if(errors=res.errors){form.find(".form_errors").text(errors.join(", "));return}if(res.success){_this.el.addClass("has_submitted");return _this.el.removeClass("has_changes")}}}(this))};SuggestTagDescriptionLightbox.prototype.first_show=function(){return I.with_redactor(function(_this){return function(){var input;return input=I.redactor(_this.el.find(".tag_description_input"),{minHeight:120,changeCallback:_.once(function(){return _this.el.addClass("has_changes")})})}}(this))};return SuggestTagDescriptionLightbox}(I.Lightbox)}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CollectionLightbox=function(superClass){extend(CollectionLightbox,superClass);function CollectionLightbox(){return CollectionLightbox.__super__.constructor.apply(this,arguments)}CollectionLightbox.prototype.init=function(){var form;I.has_follow_button(this.el);I.event2("view add to collection lightbox");this.el.find("input[type='radio']:first").prop("checked",true);this.el.on("click change",".collection_option",function(_this){return function(e){var row;row=$(e.currentTarget);return row.find("input[type='radio']").prop("checked",true)}}(this));form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}_this.el.addClass("is_complete");return _this.el.find(".after_submit .collection_name").text(res.title).attr("href",res.url)}}(this));this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:40,source:false,buttons:["bold","italic","deleted","lists","link"]})}}(this));return this.with_selectize(function(_this){return function(){return _this.el.find("select.collection_input").selectize()}}(this))};return CollectionLightbox}(I.Lightbox)}).call(this);
