import requests
import json


apikey = '39c27871dcf2ffdf90c0b961070156afa19673350d263c14175a44a7b11e19c0'


# response = requests.get(url_file_req, params=params)
# print(response.json())


def get_quotas():
	url_quotas = 'https://www.virustotal.com/api/v3/users/'
	headers = {'x-apikey': apikey}

	response = requests.get(url_quotas + apikey, headers=headers)
	response_json = json.loads(response.text)
	return response_json['data']['attributes']['quotas']

def within_quotas(quotas):
	for k in quotas:
		if quotas[k]['used'] >= quotas[k]['allowed'] and quotas[k]['allowed'] > 0:
			return False

	return True

def print_nonzero_quotas(quotas):
	for k in quotas:
		if quotas[k]['used'] > 0:
			print("used: ", quotas[k]['used'], " allowed: ", quotas[k]['allowed'])

def post_file(file):
	url = 'https://www.virustotal.com/vtapi/v2/file/scan'
	params = {'apikey': apikey}
	# TODO: decide file formatting
	files = {'file': (file, open(file, 'rb'))}
	response = requests.post(url, files=files, params=params)
	response_json = json.loads(response.text)
	return response_json

def check_file(resource):
	url_file_req = 'https://www.virustotal.com/vtapi/v2/file/report'
	params = {'apikey': apikey, 'resource': resource}
	response = requests.get(url_file_req, params=params)
	return response.json()

quotas = get_quotas()
print_nonzero_quotas(quotas)
# if (within_quotas(quotas)):
# 	print(check_file('e8bf0004af0266b99d272ea0e1588504c99e695dab5e3ff732e95935f9212930'))

# print(response.json())
# print(response_json['quotas'])